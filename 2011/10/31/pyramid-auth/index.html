<!doctype html>
<html>
  <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      
      <title>Pyramid Authentication and Authorization | 稻草人.L的记录</title>
      <!--<link href="http://fonts.googleapis.com/css?family=Vollkorn&subset=latin" rel="stylesheet" type="text/css">-->
      <link rel="stylesheet" href="/develop-notes/static/style.css" type="text/css">
      <link rel="stylesheet" href="/static/_pygments.css" type="text/css">
      
  </head>
  <body>
      <div class=container>
          <div class=header>
              <a href="/">稻草人.L的记录</a>
          </div>
          <div class=navigation>
              <ul>
                  <li><a href="/develop-notes/">blog</a></li>
                  <li><a href="/develop-notes/archive/">archive</a></li>
                  <li><a href="/develop-notes/tags/">tags</a></li>
                  <li><a href="/develop-notes/feed.atom" rel="alternate" title="Recent Blog Posts">feed</a></li>
              </ul>
          </div>
          <div class=body>
              
  <h1 class="title">Pyramid Authentication and Authorization</h1>

  
  <p class=date>written on Monday, October 31, 2011
  

  <div class="section" id="forbidden-vs-unauthorized">
<h2>Forbidden vs Unauthorized</h2>
<p><a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/1.2/narr/security.html">官方1.2文档</a>:</p>
<pre class="literal-block">
if the authorization policy denies access, the view callable is not invoked;
instead the Forbidden view is invoked.
</pre>
<p>不满足权限要求, 抛出 <em>pyramid.httpexceptions.HTTPForbidden</em>, 即使使用 <a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/1.2/api/security.html#pyramid.security.Authenticated">security.Authenticated</a>, 得到的也是Forbidden的403, 而不是Unauthorized的401.</p>
<p>对于某资源, 非登录用户无权限访问而显示个登录界面是个不错的用户体验; 但对于登录用户无权限访问时, 给对方显示个登录界面颇为不妥. 至今了解到的资料, 在pyramid默认的auth机制中, 分离 <em>login_required</em> 和 <em>permission</em> 还得额外处理.</p>
</div>
<div class="section" id="default-permission">
<h2>default permission</h2>
<p><a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/1.2/narr/security.html#setting-a-default-permission">Setting a Default Permission</a></p>
<p>避免循环, 对于 <em>HTTPForbidden View</em> 要开放权限 <a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/1.2/api/security.html#pyramid.security.NO_PERMISSION_REQUIRED">pyramid.security.NO_PERMISSION_REQUIED</a>:</p>
<div class="highlight"><pre> <span class="c">#默认都得登录才能访问</span>
<span class="n">config</span><span class="o">.</span><span class="n">set_default_permission</span><span class="p">(</span><span class="s">&#39;login_required&#39;</span><span class="p">)</span>

<span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="s">&#39;project.views.login&#39;</span><span class="p">,</span>
                <span class="n">renderer</span><span class="o">=</span><span class="s">&#39;login.mako&#39;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="s">&#39;pyramid.httpexceptions.HTTPForbidden&#39;</span><span class="p">,</span>
                <span class="n">permission</span><span class="o">=</span><span class="n">NO_PERMISSION_REQUIRED</span><span class="s">&#39;</span>
                <span class="p">)</span>
</pre></div>
</div>
<div class="section" id="traversal-context">
<h2>traversal context</h2>
<p>访问无权限时直接显示登录界面而不作跳转. 以前在Django学到的方式是: 用decorator判断, 直接调用login_view作为返回. 而在pyramid可以用traversalh直接设定context:</p>
<div class="highlight"><pre><span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="s">&#39;project.views.login&#39;</span><span class="p">,</span>
                <span class="n">renderer</span><span class="o">=</span><span class="s">&#39;login.mako&#39;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="s">&#39;pyramid.httpexceptions.HTTPUnathorized&#39;</span><span class="p">,</span>
                <span class="p">)</span>
</pre></div>
<p>注意上面的代码没有&quot;route_name&quot;, 即使带&quot;route_name&quot;也会被忽略, 导致无法直接访问登录页面. 解决方法是再用 <a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/1.2/narr/urldispatch.html#urldispatch-chapter">URL Dispatch</a> 的方式再添加登录界面一次. (traversal的方式, 还没搞明白)</p>
</div>
<div class="section" id="pyramid-auth-api-design-postmortem">
<h2>Pyramid &quot;Auth&quot; API Design Postmortem</h2>
<p>Chrism写得API设计验尸报告, <a class="reference external" href="http://plope.com/pyramid_auth_design_api_postmortem">http://plope.com/pyramid_auth_design_api_postmortem</a></p>
<ol class="arabic simple">
<li>The &quot;groupfinder&quot; is a &quot;knob on a knob&quot;. A Pyramid authentication policy is already replaceable wholesale; you can write a custom authentication policy and use it as necessary. However, because writing a custom authentication policy no fun, the default authentication policies themselves have become miniframeworks by allowing (really, requiring) a user to pass a &quot;groupfinder&quot; function. This is a common source of confusion. It would be much better if there was only one &quot;knob&quot; for a user to turn: registering a custom authentication policy, rather than two (allowing a custom authentication policy or allowing them to use the groupfinder miniframework with stock authentication policies). But for it to be feasible for a nonexpert user to create an authentication policy, the contract of the policy itself needs to be simpler.</li>
<li>If the user wants to control the horizontal and vertical of authorization, they have to override both the authentication policy and the authorization policy bacause both rely on persistent storage local to the application itself. This is bad.</li>
</ol>
<p>只需要简单的登录验证, 默认提供的auth机制的确够用了. 复杂一点的就选择repoze.who. 为在pyramid上面使用repoze.who提供了个支持.</p>
<p>[Mon Oct 31 15:18:23 CST 2011]</p>
</div>


  
  <p class=tags>This entry was tagged
    
      <a href="/develop-notes/tags/pyramid/">pyramid</a>
  

          </div>
          <div class=footer>
              <p>&copy; Copyright 2013 by 稻草人.L
              <p>
              Content licensed under the Creative Commons
              attribution-noncommercial-sharealike License.
              <p>
              联系我: 
	      <span>Tukki.Eta(#)gmail.com</span> &nbsp;
	      <a href="http://twitter.com/scarecrow_L">Twitter</a> &nbsp;
          <a href="https://www.github.com/tukki">Github</></a> &nbsp;
      </div>

          </div>
      </div>
  </body>
</html>
