<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title type="text">Recent Blog Posts</title>
  <id>/develop-notes/feed.atom</id>
  <updated>2011-10-09T00:00:00Z</updated>
  <link href="/develop-notes/" />
  <link href="/develop-notes/feed.atom" rel="self" />
  <subtitle type="text">Recent blog posts</subtitle>
  <generator>Werkzeug</generator>
  <entry xml:base="/develop-notes/feed.atom">
    <title type="text">Notes for Pyramid with Nginx</title>
    <id>/develop-notes/2011/10/09/notes-for-Pyramid-with-Nginx</id>
    <updated>2011-10-09T00:00:00Z</updated>
    <link href="/develop-notes/2011/10/09/notes-for-Pyramid-with-Nginx" />
    <author>
      <name>稻草人.L</name>
    </author>
    <content type="html">&lt;p&gt;pyramid_cookbook上的 &lt;a class="reference external" href="https://docs.pylonsproject.org/projects/pyramid_cookbook/dev/deployment/nginx.html"&gt;Nginx + paster + supervisord&lt;/a&gt;.&lt;/p&gt;
&lt;div class="section" id="pastescript-cherrypy"&gt;
&lt;h2&gt;PasteScript#cherrypy使用&lt;/h2&gt;
&lt;p&gt;the pyramid cookbook在当前(v0.1)版本, 使用PasteScript#cherrypy作为server:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[server:main]
host = 127.0.0.1
port = %(http_port)s

use = egg:PasteScript#cherrypy
numthreads = 10
timeout = 180
request_queue_size = 200
&lt;/pre&gt;
&lt;p&gt;如果使用Pastecript-1.7.4.2版本, 会抛出:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
lib/python2.5/site-packages/paste/script/cherrypy_server.py&amp;quot;, line 4, in &amp;lt;module&amp;gt;
import paste.script.wsgiserver as wsgiserver
ImportError: No module named wsgiserver
&lt;/pre&gt;
&lt;p&gt;在PasteScript的BitBucket有相关记录 &lt;a class="reference external" href="https://bitbucket.org/ianb/pastescript/issue/1/no-module-named-pastescriptwsgiserver"&gt;Issue #1&lt;/a&gt;:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
The module paste.script.wsgiserver seems to have been removed when going from 1.7.3 to 1.7.4.
&lt;/pre&gt;
&lt;p&gt;如果一定要使用这配置, 使用pastescript==1.7.3版本才行. 官方文档需要更新了.&lt;/p&gt;
&lt;p&gt;疑问: 查看cherry_server.py的 &lt;a class="reference external" href="https://bitbucket.org/ianb/pastescript/changeset/8e8ae01e5231#chg-paste/script/cherrypy_server.py"&gt;history&lt;/a&gt;, 07年已经不再依赖CherryPy. 那CherryPy一直以来的更新和优化, 是不是一致没有用上?&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="pastedeployprefixmiddleware"&gt;
&lt;h2&gt;使用PasteDeploy的prefixMiddleware&lt;/h2&gt;
&lt;p&gt;在[filter:paste_prefix]中添加:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
prefix = /prefix
&lt;/pre&gt;
&lt;p&gt;然后在nginx的location可以设置对应的prefix.&lt;/p&gt;
&lt;/div&gt;
</content>
  </entry>
  <entry xml:base="/develop-notes/feed.atom">
    <title type="text">using nginx virtual host without default port</title>
    <id>/develop-notes/2011/10/09/using-nginx-virtual-host-without-default-port</id>
    <updated>2011-10-09T00:00:00Z</updated>
    <link href="/develop-notes/2011/10/09/using-nginx-virtual-host-without-default-port" />
    <author>
      <name>稻草人.L</name>
    </author>
    <content type="html">&lt;p&gt;In the Nginx &lt;a class="reference external" href="http://wiki.nginx.org/VirtualHostExample"&gt;Virtual Host official examples&lt;/a&gt; showing how to setup the Virtual Host with default port &lt;em&gt;80&lt;/em&gt;, and tell us can replace 80 with the right one for our requirements. It souds great.&lt;/p&gt;
&lt;p&gt;This tiem I just want to setup my pyramid project with nginx just like &lt;a class="reference external" href="https://docs.pylonsproject.org/projects/pyramid_cookbook/dev/deployment/nginx.html"&gt;pyramid cookbook&lt;/a&gt;
showing. All things smoothly going except the PasteScript missing 'wsgiServer'. But the nightmare appearanced when I changed the listening port to &lt;em&gt;8080&lt;/em&gt; - all the links point to 'localhost', yet, there was no 8080. Google for it and try the solutions, only the this worked.:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
proxy_set_header Host $host:8080
&lt;/pre&gt;
&lt;p&gt;Checked the Nginx &lt;a class="reference external" href="http://wiki.nginx.org/HttpProxyModule#proxy_set_header"&gt;HttpProxyModele&lt;/a&gt; document:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
The unchanged request-header &amp;quot;Host&amp;quot; can be transmitted like this:

    proxy_set_header Host $http_host;

However, if this line is absent from the client request,
then nothing will be transferred.

In this case it is better to use variable $host,
it's value is equal to the name of server in the request-header &amp;quot;Host&amp;quot;
or to the basic name of server, if there is no line:

    proxy_set_header Host $host;

Furthermore, it is possible to transmit the name of server together
with the port of the proxied server:

    proxy_set_header Host $host:$proxy_port;
&lt;/pre&gt;
&lt;p&gt;Sound like the &lt;em&gt;$proxy_port&lt;/em&gt; is the general and perfect solution. But I'm wrong, it did not work. If I only use the $proxy_port, the links show me that the value is &lt;strong&gt;0.0.80&lt;/strong&gt;. WTH...&lt;/p&gt;
&lt;p&gt;Anyway, these configures work:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
proxy_set_header Host $http_host;
&lt;/pre&gt;
&lt;p&gt;or:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
proxy_set_header Host $host;
&lt;/pre&gt;
</content>
  </entry>
</feed>

