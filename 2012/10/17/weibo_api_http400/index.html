<!doctype html>
<html>
  <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      
      <title>weibo api http400 错误 | 稻草人.L的记录</title>
      <!--<link href="http://fonts.googleapis.com/css?family=Vollkorn&subset=latin" rel="stylesheet" type="text/css">-->
      <link rel="stylesheet" href="/static/style.css" type="text/css">
      <link rel="stylesheet" href="/static/_pygments.css" type="text/css">
      
  </head>
  <body>
      <div class=container>
          <div class=header>
              <a href="/">稻草人.L的记录</a>
          </div>
          <div class=navigation>
              <ul>
                  <li><a href="/">blog</a></li>
                  <li><a href="/archive/">archive</a></li>
                  <li><a href="/tags/">tags</a></li>
                  <li><a href="/feed.atom" rel="alternate" title="Recent Blog Posts">feed</a></li>
              </ul>
          </div>
          <div class=body>
              
  <h1 class="title">weibo api http400 错误</h1>

  
  <p class=date>written on Wednesday, October 17, 2012
  

  <p>sina weibo api 在请求错误时返回错误信息json, 但http code不是200. 现在看来也合情合理. 错误请求, 当然返回错误代号.</p>
<p>只是, 用python默认的urllib2来发送请求, 默认只处理100-400之间的codes. 所以,  http400这些错误还得自己来.</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">urllib2</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">urlopen</span><span class="p">,</span> <span class="n">URLError</span><span class="p">,</span> <span class="n">HTTPError</span>
<span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">weiboapi</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">success</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">except</span> <span class="n">HTTPError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">success</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">print</span> <span class="n">success</span><span class="p">,</span> <span class="n">result</span>
</pre></div>
<p>wget也是没有处理这个http400错误. curl倒是有. requests也处理了. 在status_code.py里面有定义.</p>
<p>现在有个没定位的问题, 为什么用requests发送部分请求时总是成功, 但用urllib2就抛错误. 这个得再跟进下.</p>
<p><a class="reference external" href="http://www.voidspace.org.uk/python/articles/urllib2.shtml#error-codes">这里</a> 个code对应表:</p>
<pre class="literal-block">
# Table mapping response codes to messages; entries have the
# form {code: (shortmessage, longmessage)}.
responses = {
 100: ('Continue', 'Request received, please continue'),
 101: ('Switching Protocols',
       'Switching to new protocol; obey Upgrade header'),

 200: ('OK', 'Request fulfilled, document follows'),
 201: ('Created', 'Document created, URL follows'),
 202: ('Accepted',
       'Request accepted, processing continues off-line'),
 203: ('Non-Authoritative Information', 'Request fulfilled from cache'),
 204: ('No Content', 'Request fulfilled, nothing follows'),
 205: ('Reset Content', 'Clear input form for further input.'),
 206: ('Partial Content', 'Partial content follows.'),

 300: ('Multiple Choices',
       'Object has several resources -- see URI list'),
 301: ('Moved Permanently', 'Object moved permanently -- see URI list'),
 302: ('Found', 'Object moved temporarily -- see URI list'),
 303: ('See Other', 'Object moved -- see Method and URL list'),
 304: ('Not Modified',
       'Document has not changed since given time'),
 305: ('Use Proxy',
       'You must use proxy specified in Location to access this '
       'resource.'),
 307: ('Temporary Redirect',
       'Object moved temporarily -- see URI list'),

 400: ('Bad Request',
       'Bad request syntax or unsupported method'),
 401: ('Unauthorized',
       'No permission -- see authorization schemes'),
 402: ('Payment Required',
       'No payment -- see charging schemes'),
 403: ('Forbidden',
       'Request forbidden -- authorization will not help'),
 404: ('Not Found', 'Nothing matches the given URI'),
 405: ('Method Not Allowed',
       'Specified method is invalid for this server.'),
 406: ('Not Acceptable', 'URI not available in preferred format.'),
 407: ('Proxy Authentication Required', 'You must authenticate with '
       'this proxy before proceeding.'),
 408: ('Request Timeout', 'Request timed out; try again later.'),
 409: ('Conflict', 'Request conflict.'),
 410: ('Gone',
       'URI no longer exists and has been permanently removed.'),
 411: ('Length Required', 'Client must specify Content-Length.'),
 412: ('Precondition Failed', 'Precondition in headers is false.'),
 413: ('Request Entity Too Large', 'Entity is too large.'),
 414: ('Request-URI Too Long', 'URI is too long.'),
 415: ('Unsupported Media Type', 'Entity body in unsupported format.'),
 416: ('Requested Range Not Satisfiable',
       'Cannot satisfy request range.'),
 417: ('Expectation Failed',
       'Expect condition could not be satisfied.'),

 500: ('Internal Server Error', 'Server got itself in trouble'),
 501: ('Not Implemented',
       'Server does not support this operation'),
 502: ('Bad Gateway', 'Invalid responses from another server/proxy.'),
 503: ('Service Unavailable',
       'The server cannot process the request due to a high load'),
 504: ('Gateway Timeout',
       'The gateway server did not receive a timely response'),
 505: ('HTTP Version Not Supported', 'Cannot fulfill request.'),
 }
</pre>


  

          </div>
          <div class=footer>
              <p>&copy; Copyright 2013 by 稻草人.L
              <p>
              Content licensed under the Creative Commons
              attribution-noncommercial-sharealike License.
              <p>
              联系我: 
	      <span>Tukki.Eta(#)gmail.com</span> &nbsp;
	      <a href="http://twitter.com/scarecrow_L">Twitter</a> &nbsp;
          <a href="https://www.github.com/tukki">Github</></a> &nbsp;
      </div>

          </div>
      </div>
  </body>
</html>
